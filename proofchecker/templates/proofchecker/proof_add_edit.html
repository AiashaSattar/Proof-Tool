{% extends 'proofchecker/base.html' %}
{% load static %}
{% block content %}

<style>
    .hidden{
        display: none;
    }
</style>

<h3>Proof {{ object.pk }}</h3>
<hr>
<form action="" method="post">
    <div>
        {% csrf_token %}
        {{ form.as_table }}
    </div>

    <hr>

    {% if formset %}

    {{ formset.management_form }}

    <!-- Display lines -->  
    <table class="table table-bordered table-hover table-sm table-responsive">

        <thead id="column-titles">
            <tr class="font-weight-bold">
                <td>Line #</td>
                <td>Expression</td>
                <td>Rule</td>
            </tr>
        </thead>

        <tbody id="proof-line-list">
            {% for line in formset %}
                {% if not line.DELETE.value %}
                    <tr class="proofline-form" id="proofline-form-{{ forloop.counter0 }}">
                        <td>{{ line.line_no }}</td>
                        <td>{{ line.formula }}</td>
                        <td>{{ line.rule }}</td>
                        <td>
                            <input class="insert-row" type="button" id="id-form-btn-insert-row-{{ forloop.counter0 }}" 
                                value="Insert Row" onclick="add_new_form(this)">
                        </td>
                        <td>
                            <input class="delete-row" type="button" id="id-form-btn-delete-row-{{ forloop.counter0 }}" 
                                value="Delete" onclick="removeProofline(this)">
                        </td>
                        <td class="hidden">
                            {{ line.DELETE }}
                        </td>
                    </div>
                {% endif %}
            {% endfor %}

            <tr id="empty-form" class="hidden">
                <td>{{ formset.empty_form.line_no }}</td>
                <td>{{ formset.empty_form.formula }}</td>
                <td>{{ formset.empty_form.rule }}</td>
                <td>
                    <input class="insert-row" type="button" id="id-form-btn-insert-row-__prefix__" 
                        value="Insert Row" onclick="add_new_form(this)">
                </td>
                <td>
                    <input class="delete-row" type="button" id="id-form-btn-delete-row-__prefix__" 
                        value="Delete" onclick="removeProofline(this)">
                </td>
                <td class="hidden">
                    {{ formset.empty_form.DELETE}}
                </td>
            </tr>
        </tbody>

    </table>
    
    <button id="add-more" type="button">Add Proof Line</button>
    {% endif %}

    <hr>
    <input type="text" class="hidden" id="check-proof">
    <button name="check_proof" type="submit">Check Proof</button>
    <button name="submit" type="submit">Save</button>

    <!-- Display validation errors from form fields-->
    {% for line in formset %}

        {% if line.non_field_errors %}
            <div>
                {{ line.non_field_errors }}
            </div>
        {% endif %}

        {% for field in line %}
            {% if field.errors %}
            <div class="container">
                {% for error in field.errors %}
                <div class="row">
                    
                    {% if line.line_no.value %}
                    <p><strong>Error on line {{line.line_no.value}}, field {{ field.label_tag }}</strong> {{ error }}</p>
                    {% else %}
                    <p><strong>Error field {{ field.label_tag }}</strong> {{ error }}</p>

                    {% endif %}
                </div>
                {% endfor %}
            </div>
            {% endif %}
        {% endfor %}
    {% endfor %}

    <!-- Display response from Proof Checker-->
    {% if response %}

    {% if response.err_msg %}
    <p> <strong>Result:</strong> {{ response.err_msg }} </p>
    {% else %}
    <p> <strong>Result:</strong> The proof is valid and complete!</p>
    {% endif %}
        
    {% endif %}

</form>

<script src="{% static 'js/add_edit.js' %}"></script>

{% include 'proofchecker/right_navigation_menu.html' %}
{% endblock %}


{% block js_block %}
    <script type="text/javascript" src="{% static 'js/line_functionality.js' %}"></script>
{% endblock %}
