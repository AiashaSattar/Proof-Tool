{% extends 'proofchecker/base.html' %}
{% load static %}
{% block content %}
    <h3>Proof {{ object.pk }}</h3>
    <hr>
    <form action="" method="post">
        <div>
            {% csrf_token %}
            {{ form.as_table }}
        </div>
        <hr>
        <div id="init_proof">
            <button type="button" id="btn_init_proof" onclick="init_proof()">Start Proof</button>
        </div>
        <hr>
        {% if formset %}
            {{ formset.management_form }}
            <!-- Display lines -->
            <table class="table table-striped table-bordered table-hover table-sm table-responsive" id="proof-table">
                <thead id="column-titles">
                    <tr class="font-weight-bold">
                        <td>Line #</td>
                        <td>Expression</td>
                        <td>Rule</td>
                    </tr>
                </thead>
                <tbody id="proofline-list">
                    {% for line in formset %}
                        <tr id="proofline_set-{{ forloop.counter0 }}" class="proofline_set">
                            <td hidden>{{ line.id }}{{ line.DELETE }}</td>
                            {% if line.DELETE.value  %}
                                <td hidden>{{ line.line_no }}</td>
                                <td hidden>{{ line.formula }}</td>
                                <td hidden>{{ line.rule }}</td>
                                <td hidden><input class="insert-row" type="button" id="id-form-btn-insert-row-{{ forloop.counter0 }}" value="Insert Row" onclick="add_proofline_form(this)"></td>
                                <td hidden><input class="delete-row" type="button" id="id-form-btn-delete-row-{{ forloop.counter0 }}" value="Delete" onclick="remove_proofline_form(this)"></td>
                            {% else %}
                                <td>{{ line.line_no }}</td>
                                <td>{{ line.formula }}</td>
                                <td>{{ line.rule }}</td>
                                <td><input class="insert-row" type="button" id="id-form-btn-insert-row-{{ forloop.counter0 }}" value="Insert Row" onclick="add_proofline_form(this)"></td>
                                <td><input class="delete-row" type="button" id="id-form-btn-delete-row-{{ forloop.counter0 }}" value="Delete" onclick="remove_proofline_form(this)"></td>
                            {% endif %}
                        </tr>
                    {% endfor %}
                    <tr id="empty-form" class="hidden">
                        <td hidden>{{ formset.empty_form.id }}{{ formset.empty_form.DELETE }}</td>
                        <td>{{ formset.empty_form.line_no }}</td>
                        <td>{{ formset.empty_form.formula }}</td>
                        <td>{{ formset.empty_form.rule }}</td>
                        <td><input class="insert-row" type="button" id="id-form-btn-insert-row-__prefix__" value="Insert Row" onclick="add_proofline_form(this)"></td>
                        <td><input class="delete-row" type="button" id="id-form-btn-delete-row-__prefix__" value="Delete" onclick="remove_proofline_form(this)"></td>
                    </tr>
                </tbody>
            </table>
        {% endif %}
        <hr>

        <!-- Display validation errors from form fields-->
        {% for line in formset %}
            {% for field in line %}
                {% if field.errors %}
                <div class="container">
                    {% for error in field.errors %}
                    <div class="row">
                        {% if line.line_no.value %}
                        <p><strong>Error on line {{line.line_no.value}}:</strong> {{ error }}</p>
                        {% elif error == "This field is required." %}
                        <p><strong>Error:</strong> All fields are required</p>
                        {% else %}
                        <p><strong>Error:</strong> {{ error }}</p>

                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
                {% endif %}
            {% endfor %}
        {% endfor %}

        <!-- Display response from Proof Checker-->
        {% if response %}

        {% if response.err_msg %}
        <p> <strong>Result:</strong> {{ response.err_msg }} </p>
        {% else %}
        <p> <strong>Result:</strong> The proof is valid and complete!</p>
        {% endif %}

        {% endif %}

        <button name="check_proof"ntype="submit">Check Proof</button>
        <button name="submit" type="submit">Save</button>
    </form>

    {% include 'proofchecker/right_navigation_menu.html' %}

    {% block js_block %}
        <script type="text/javascript" src="{% static 'js/line_functionality.js' %}"></script>
        <script src="{% static 'js/add_edit.js' %}"></script>
    {% endblock %}
{% endblock %}



